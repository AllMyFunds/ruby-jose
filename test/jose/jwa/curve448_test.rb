require 'test_helper'

class JOSE::JWA::Curve448Test < Minitest::Test

  EdDSA_SECRET      = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].pack('C*')
  EdDSA_SK          = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,91,58,254,3,135,138,73,178,130,50,212,241,164,66,174,189,225,9,248,7,172,239,125,253,154,127,101,185,98,254,82,214,84,115,18,202,206,207,240,67,55,80,143,157,37,41,168,241,102,145,105,178,28,50,196,128,0].pack('C*')
  EdDSA_PK          = [91,58,254,3,135,138,73,178,130,50,212,241,164,66,174,189,225,9,248,7,172,239,125,253,154,127,101,185,98,254,82,214,84,115,18,202,206,207,240,67,55,80,143,157,37,41,168,241,102,145,105,178,28,50,196,128,0].pack('C*')
  EdDSA_M           = [].pack('C*')
  Ed448_SIGNATURE   = [206,106,178,49,105,13,50,44,75,79,82,73,118,80,144,188,234,135,97,59,126,152,200,226,47,248,104,218,224,166,20,30,138,142,89,222,49,219,102,114,248,145,18,159,72,61,143,174,62,18,224,21,227,109,40,53,128,165,41,18,125,55,90,55,136,132,49,38,227,232,214,102,162,231,158,161,12,122,233,16,119,110,139,233,241,193,36,28,10,112,88,140,255,201,97,2,114,252,4,136,197,200,119,185,124,158,81,176,237,13,115,57,18,0].pack('C*')
  Ed448ph_SIGNATURE = [160,153,38,246,227,95,68,228,18,181,67,18,117,18,42,239,211,55,240,216,159,60,173,91,54,170,114,183,100,207,8,205,13,162,66,65,32,179,199,216,226,79,38,110,177,219,97,193,128,133,110,7,74,162,189,251,128,76,153,107,130,254,107,174,68,170,250,57,248,54,23,201,0,49,35,73,72,67,82,59,159,77,31,251,29,62,39,123,145,64,138,108,173,158,150,82,243,98,131,205,102,0,222,161,252,160,255,102,74,226,161,126,15,0].pack('C*')
  Curve448_SECRET   = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128].pack('C*')
  Curve448_PUBLIC   = [233,184,32,164,77,186,59,197,105,190,231,33,75,98,176,158,226,57,181,9,120,167,161,198,154,154,222,70,133,140,195,124,72,235,3,253,136,194,137,186,221,112,143,198,53,199,216,99,204,64,228,223,221,109,93,64].pack('C*')
  Curve448_SHARED   = [16,234,247,42,52,171,23,62,9,108,78,190,51,23,34,173,4,71,131,232,130,100,201,241,71,247,147,8,138,90,155,119,115,45,182,116,44,231,252,178,30,89,63,175,193,57,217,201,44,220,2,201,10,92,212,120].pack('C*')

  def test_supported_methods
    [
      [[EdDSA_PK, EdDSA_SK], :ed448_keypair, EdDSA_SECRET],
      [EdDSA_PK, :ed448_secret_to_public, EdDSA_SK],
      [Ed448_SIGNATURE, :ed448_sign, EdDSA_M, EdDSA_SK],
      [true, :ed448_verify, Ed448_SIGNATURE, EdDSA_M, EdDSA_PK],
      [[EdDSA_PK, EdDSA_SK], :ed448ph_keypair, EdDSA_SECRET],
      [EdDSA_PK, :ed448ph_secret_to_public, EdDSA_SK],
      [Ed448ph_SIGNATURE, :ed448ph_sign, EdDSA_M, EdDSA_SK],
      [true, :ed448ph_verify, Ed448ph_SIGNATURE, EdDSA_M, EdDSA_PK],
      [[Curve448_PUBLIC, Curve448_SECRET], :x448_keypair, Curve448_SECRET],
      [Curve448_PUBLIC, :x448_secret_to_public, Curve448_SECRET],
      [Curve448_SHARED, :x448_shared_secret, Curve448_PUBLIC, Curve448_SECRET]
    ].each do |(expected, function, *args)|
      assert_equal expected, JOSE::JWA::Curve448.send(function, *args)
    end
  end

end
